BootStrap: docker
From: ubuntu

%environment
    export LC_ALL=C
    export nvcc_arch="sm_75"

%post
    apt update
    apt install -y git
    apt install -y openjdk-11-jdk
    apt install -y maven
    apt install -y gcc
    apt install -y nvidia-cuda-toolkit

    cd /usr/local/src
    git clone https://github.com/shermanlo77/modefilter.git
    cd modefilter
    sed -i -r 's/sm_[0-9]+/'${nvcc_arch}'/g' Makefile
    make
    mvn package

%runscript
    unset DISPLAY
    java -jar /usr/local/src/modefilter/target/Empirical_Null_Filter-*.jar "$@"
